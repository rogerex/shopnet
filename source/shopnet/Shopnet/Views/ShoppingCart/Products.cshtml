@model IEnumerable<Shopnet.Models.Product>

@{
    Layout = null;
}

<div id="update-message-product">
</div>
    <table>
        <tr>
            <th>
                Code
            </th>
            <th>
                Price
            </th>
            <th></th>
        </tr>
    
    @foreach (var item in Model) {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.Code)<br />
                @Html.DisplayFor(modelItem => item.Name)
            </td>
            <td colspan="2">
                <div class="product-left">
                    <input type="text" id="price-product-@item.ProductID" value="@String.Format("{0:F}", item.Price)"/>
                    <input type="hidden" id="current-price-product-@item.ProductID" value="@String.Format("{0:F}", item.Price)"/>
                </div>
                
                <div class="product-right">
                    <a href="#" class="Link" data-id="@item.ProductID">Add to cart</a>
                </div>
            </td>
        </tr>
    }
   
    </table>

<script type="text/javascript">
    $(function () {
        // Document.ready -> link up remove event handler
        $(".Link").click(function () {
            // Get the id from the link
            productID = $(this).attr("data-id");
            price = $("#price-product-" + productID).val().replace(",", ".");
            currentPrice = $("#current-price-product-" + productID).val().replace(",", ".");

            if (productID != '') {
                price = parseFloat(price);
                currentPrice = parseFloat(currentPrice);
                if (!isNaN(price) && isFinite(price) && !isNaN(currentPrice) && isFinite(currentPrice)) {
                    if (price >= currentPrice) {
                        window.location = "/ShoppingCart/AddToCart/" + productID + "?price=" + price;
                    } else {
                        $('#update-message').text('The price must be a greater or equal to current price');
                    }
                } else {
                    $('#update-message').text('The product price must be a number');
                }
            } else {
                $('#update-message').text('The product value is not valid');
            }
        });

    });
</script>

